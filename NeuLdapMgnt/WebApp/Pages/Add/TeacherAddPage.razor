@page "/teachers/add"

<PageTitle>Add Teacher</PageTitle>

<h1>Add Teacher</h1>

@if (isSubmitting)
{
	<Loading Text="@submitString" />
}
else
{
	<FormTeacher Teacher="teacher" CanDelete="false" IsReadonly="false" OnSubmit="OnSubmit" />
	<ConfirmDialog @ref="dialog" />
}

@code {
	private Teacher teacher = new();
	private ConfirmDialog dialog = default!;

	private string modalTitle => $"Error";
	private string submitString => $"Creating {teacher.FullName}";
	private bool isSubmitting = false;

	protected override async Task OnInitializedAsync()
	{
		ApiRequests.EnsureAuthentication(NavManager);
		await LocalDbService.FetchClassesAsync();
	}

	private async Task<bool> OnSubmit(Teacher teacherUpdated)
	{
		var parameters = new Dictionary<string, object>();
		parameters.Add("Teacher", teacherUpdated);

		var confirmation = await dialog.ShowAsync<SummaryTeacher>("Create this teacher?", parameters, DialogOptions.Confirm());
		if (!confirmation) return false;

		isSubmitting = true;
		await TeacherService.AddTeacherAsync(teacherUpdated);
		isSubmitting = false;
		return false;
	}
}
